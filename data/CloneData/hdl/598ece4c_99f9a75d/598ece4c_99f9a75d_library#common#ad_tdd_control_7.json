{"Source Block": ["hdl/library/common/ad_tdd_control.v@196:251@HdlStmProcess", "\n  // ***************************************************************************\n  // tdd counter (state machine)\n  // ***************************************************************************\n\n  always @(posedge clk) begin\n\n    // sync reset\n    if (rst == 1'b1) begin\n      tdd_counter <= 24'h0;\n      tdd_counter_state <= OFF;\n    end else begin\n\n      // counter reset\n      if (tdd_counter_reset == 1'b1) begin\n        tdd_counter_state <= OFF;\n      end else\n\n      // start counter, the start pulse should have one clock cycle\n      // NOTE: a start pulse during a transaction will reinitialize the counter\n      if (tdd_start == 1'b1) begin\n        tdd_counter <= tdd_counter_init;\n        tdd_burst_counter <= tdd_burst_count;\n        tdd_counter_state <= ON;\n      end else\n\n      // free running counter\n      if (tdd_counter_state == ON) begin\n        if (tdd_counter == tdd_frame_length) begin\n          tdd_counter <= 22'h0;\n          if (tdd_burst_en == 1) begin\n            if ( tdd_burst_counter > 0) begin // inside a burst\n              tdd_burst_counter <= tdd_burst_counter - 1;\n              tdd_counter_state <= ON;\n            end\n            else begin // end of burst\n              tdd_burst_counter <= 6'h0;\n              tdd_counter_state <= OFF;\n            end\n          end\n          else begin // contiuous mode\n            tdd_burst_counter <= 6'h0;\n            tdd_counter_state <= ON;\n          end\n        end\n        else begin\n          tdd_counter <= tdd_counter + 1;\n        end\n      end\n    end\n  end\n\n  // ***************************************************************************\n  // generate control signals\n  // ***************************************************************************\n\n"], "Clone Blocks": [], "Diff Content": {"Delete": [[210, "      if (tdd_counter_reset == 1'b1) begin\n"], [216, "      if (tdd_start == 1'b1) begin\n"], [226, "          if (tdd_burst_en == 1) begin\n"], [227, "            if ( tdd_burst_counter > 0) begin // inside a burst\n"], [228, "              tdd_burst_counter <= tdd_burst_counter - 1;\n"], [229, "              tdd_counter_state <= ON;\n"], [230, "            end\n"], [231, "            else begin // end of burst\n"], [232, "              tdd_burst_counter <= 6'h0;\n"], [233, "              tdd_counter_state <= OFF;\n"], [234, "            end\n"]], "Add": [[210, "      if (tdd_enable == 1'b0) begin\n"], [211, "        tdd_enable_d <= tdd_enable;\n"], [216, "      if ((tdd_enable == 1'b1) && (tdd_enable_d == 1'b0)) begin\n"], [234, "          if ( tdd_burst_counter > 1) begin // inside a burst\n"], [234, "            tdd_burst_counter <= tdd_burst_counter - 1;\n"], [234, "            tdd_counter_state <= ON;\n"], [234, "          end\n"], [234, "          else\n"], [234, "          if ( tdd_burst_counter == 1) begin // end of burst\n"], [234, "            tdd_burst_counter <= 6'h0;\n"], [234, "            tdd_counter_state <= OFF;\n"]]}}