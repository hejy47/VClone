{"Source Block": ["hdl/library/common/ad_tdd_control.v@273:330@HdlStmProcess", "\n  // ***************************************************************************\n  // tdd counter (state machine)\n  // ***************************************************************************\n\n  always @(posedge clk) begin\n\n    // sync reset\n    if (rst == 1'b1) begin\n      tdd_counter <= 24'h0;\n      tdd_counter_state <= OFF;\n      tdd_burst_state <= OFF;\n    end else begin\n\n      // counter reset\n      if (tdd_counter_reset == 1'b1) begin\n        tdd_counter_state <= OFF;\n        tdd_burst_state <= OFF;\n      end else\n\n      // start counter, the start pulse should have one clock cycle\n      // NOTE: a start pulse during a transaction will reinitialize the counter\n      if (tdd_start == 1'b1) begin\n        tdd_counter <= tdd_counter_init_d;\n        tdd_burst_counter <= tdd_burst_count_d;\n        tdd_counter_state <= ON;\n        if ((tdd_burst_en_d == 1) &&\n            ((tdd_burst_count_d > 0) || (tdd_infinite_burst_d == 1))) begin\n          tdd_burst_state <= ON;\n        end else begin\n          tdd_burst_state <= OFF;\n        end\n      end else\n\n      // free running counter\n      if (tdd_counter_state == ON) begin\n        if (tdd_counter == tdd_frame_length_d) begin\n          tdd_counter <= 22'h0;\n          if ((tdd_burst_state == ON) && ((tdd_burst_counter > 0) || (tdd_infinite_burst_d == 1))) begin\n            tdd_burst_counter <= tdd_burst_counter - 1;\n            tdd_counter_state <= ON;\n          end else begin\n            tdd_burst_counter <= 6'h0;\n            tdd_counter_state <= OFF;\n            tdd_burst_state <= OFF;\n          end\n        end else begin\n          tdd_counter <= tdd_counter + 1;\n        end\n      end\n\n    end\n  end\n\n  // ***************************************************************************\n  // generate control signals\n  // ***************************************************************************\n\n"], "Clone Blocks": [], "Diff Content": {"Delete": [[284, "      tdd_burst_state <= OFF;\n"], [290, "        tdd_burst_state <= OFF;\n"], [296, "        tdd_counter <= tdd_counter_init_d;\n"], [297, "        tdd_burst_counter <= tdd_burst_count_d;\n"], [299, "        if ((tdd_burst_en_d == 1) &&\n"], [300, "            ((tdd_burst_count_d > 0) || (tdd_infinite_burst_d == 1))) begin\n"], [301, "          tdd_burst_state <= ON;\n"], [302, "        end else begin\n"], [303, "          tdd_burst_state <= OFF;\n"], [304, "        end\n"], [309, "        if (tdd_counter == tdd_frame_length_d) begin\n"], [311, "          if ((tdd_burst_state == ON) && ((tdd_burst_counter > 0) || (tdd_infinite_burst_d == 1))) begin\n"], [312, "            tdd_burst_counter <= tdd_burst_counter - 1;\n"], [313, "            tdd_counter_state <= ON;\n"], [314, "          end else begin\n"], [316, "            tdd_counter_state <= OFF;\n"], [317, "            tdd_burst_state <= OFF;\n"], [319, "        end else begin\n"]], "Add": [[297, "        tdd_counter <= tdd_counter_init;\n"], [297, "        tdd_burst_counter <= tdd_burst_count;\n"], [309, "        if (tdd_counter == tdd_frame_length) begin\n"], [314, "          if (tdd_burst_en == 1) begin\n"], [314, "            if ( tdd_burst_counter > 0) begin // inside a burst\n"], [314, "              tdd_burst_counter <= tdd_burst_counter - 1;\n"], [314, "              tdd_counter_state <= ON;\n"], [314, "            end\n"], [314, "            else begin // end of burst\n"], [314, "              tdd_burst_counter <= 6'h0;\n"], [314, "              tdd_counter_state <= OFF;\n"], [314, "            end\n"], [314, "          end\n"], [314, "          else begin // contiuous mode\n"], [317, "            tdd_counter_state <= ON;\n"], [319, "        end\n"], [319, "        else begin\n"]]}}