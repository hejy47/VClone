{"Source Block": ["serv/rtl/serv_rf_if.v@52:145@HdlStmIf", "    */\n\n   wire \t     rd_wen = i_rd_wen & (|i_rd_waddr);\n\n   generate\n   if (WITH_CSR) begin\n   wire \t     rd = (i_ctrl_rd ) |\n\t\t\t  (i_alu_rd & i_rd_alu_en) |\n\t\t\t  (i_csr_rd & i_rd_csr_en) |\n\t\t\t  (i_mem_rd);\n\n   wire \t     mtval = i_mem_op ? i_bufreg_q : i_bad_pc;\n\n   assign \t     o_wdata0 = i_trap ? mtval  : rd;\n   assign\t     o_wdata1 = i_trap ? i_mepc : i_csr;\n\n   //port 0 rd mtval\n   //port 1 csr mepc\n   //mepc  100010\n   //mtval 100011\n   //csr   1000xx\n   //rd    0xxxxx\n   assign o_wreg0 = i_trap ? {4'b1000,CSR_MTVAL} : {1'b0,i_rd_waddr};\n   assign o_wreg1 = i_trap ? {4'b1000,CSR_MEPC}  : {4'b1000,i_csr_addr};\n\n   assign       o_wen0 = i_cnt_en & (i_trap | rd_wen);\n   assign       o_wen1 = i_cnt_en & (i_trap | i_csr_en);\n\n   /*\n    ********** Read side ***********\n    */\n\n   //0 : RS1\n   //1 : RS2 / CSR\n\n   assign o_rreg0 = {1'b0, i_rs1_raddr};\n\n   /*\n    The address of the second read port (o_rreg1) can get assigned from four\n    different sources\n\n    Normal operations : i_rs2_raddr\n    CSR access        : i_csr_addr\n    trap              : MTVEC\n    mret              : MEPC\n\n    Address 0-31 in the RF are assigned to the GPRs. After that follows the four\n    CSRs on addresses 32-35\n\n    32 MSCRATCH\n    33 MTVEC\n    34 MEPC\n    35 MTVAL\n\n    The expression below is an optimized version of this logic\n    */\n   wire sel_rs2 = !(i_trap | i_mret | i_csr_en);\n   assign o_rreg1 = {~sel_rs2,\n\t\t     i_rs2_raddr[4:2] & {3{sel_rs2}},\n\t\t     {1'b0,i_trap} | {i_mret,1'b0} | ({2{i_csr_en}} & i_csr_addr) | ({2{sel_rs2}} & i_rs2_raddr[1:0])};\n\n   assign o_rs1 = i_rdata0;\n   assign o_rs2 = i_rdata1;\n   assign o_csr = i_rdata1 & i_csr_en;\n   assign o_csr_pc = i_rdata1;\n\n   end else begin\n      wire \t     rd = (i_ctrl_rd ) |\n\t\t\t  (i_alu_rd & i_rd_alu_en) |\n\t\t\t  (i_mem_rd);\n\n      assign \t     o_wdata0 = rd;\n      assign\t     o_wdata1 = 1'b0;\n\n      assign o_wreg0 = i_rd_waddr;\n      assign o_wreg1 = 5'd0;\n\n      assign       o_wen0 = rd_wen;\n      assign       o_wen1 = 1'b0;\n\n   /*\n    ********** Read side ***********\n    */\n\n      assign o_rreg0 = i_rs1_raddr;\n      assign o_rreg1 = i_rs2_raddr;\n\n      assign o_rs1 = i_rdata0;\n      assign o_rs2 = i_rdata1;\n      assign o_csr = 1'b0;\n      assign o_csr_pc = 1'b0;\n   end // else: !if(WITH_CSR)\n   endgenerate\nendmodule\n"], "Clone Blocks": [], "Diff Content": {"Delete": [[129, "      assign       o_wen0 = rd_wen;\n"]], "Add": [[129, "      assign       o_wen0 = i_cnt_en & rd_wen;\n"]]}}