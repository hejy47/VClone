{"Source Block": ["picorv32/picosoc/spimemio.v@94:231@HdlStmProcess", "\t\t.flash_io3_di (flash_io3_di)\n\t);\n\n\treg [3:0] state;\n\n\talways @(posedge clk) begin\n\t\txfer_resetn <= 1;\n\t\tdin_valid <= 0;\n\t\tdin_data <= 8'h 00;\n\n\t\tif (!resetn) begin\n\t\t\tstate <= 0;\n\t\t\txfer_resetn <= 0;\n\t\t\trd_valid <= 0;\n\t\t\tdin_cont <= 0;\n\t\t\tdin_qspi <= 0;\n\t\t\tdin_ddr <= 0;\n\t\t\tdin_rd <= 0;\n\t\tend else begin\n\t\t\tif (dout_valid && buffer_wen[0]) buffer[ 7: 0] <= dout_data;\n\t\t\tif (dout_valid && buffer_wen[1]) buffer[15: 8] <= dout_data;\n\t\t\tif (dout_valid && buffer_wen[2]) buffer[23:16] <= dout_data;\n\t\t\tif (dout_valid && buffer_wen[3]) begin\n\t\t\t\trdata <= {dout_data, buffer};\n\t\t\t\trd_addr <= rd_inc ? rd_addr + 4 : addr;\n\t\t\t\trd_valid <= 1;\n\t\t\t\trd_wait <= rd_inc;\n\t\t\t\trd_inc <= 1;\n\t\t\tend\n\n\t\t\tif (dout_valid && buffer_wen) begin\n\t\t\t\tbuffer_wen <= 0;\n\t\t\tend\n\n\t\t\tif (valid)\n\t\t\t\trd_wait <= 0;\n\n\t\t\tcase (state)\n\t\t\t\t0: begin\n\t\t\t\t\tdin_valid <= 1;\n\t\t\t\t\tdin_data <= 8'h ff;\n\t\t\t\t\tif (din_ready)\n\t\t\t\t\t\tstate <= 1;\n\t\t\t\tend\n\t\t\t\t1: begin\n\t\t\t\t\tif (dout_valid) begin\n\t\t\t\t\t\txfer_resetn <= 0;\n\t\t\t\t\t\tstate <= 2;\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\t\t2: begin\n\t\t\t\t\tdin_valid <= 1;\n\t\t\t\t\tdin_data <= 8'h ab;\n\t\t\t\t\tif (din_ready)\n\t\t\t\t\t\tstate <= 3;\n\t\t\t\tend\n\t\t\t\t3: begin\n\t\t\t\t\tif (dout_valid) begin\n\t\t\t\t\t\txfer_resetn <= 0;\n\t\t\t\t\t\tstate <= 4;\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\t\t4: begin\n\t\t\t\t\trd_inc <= 0;\n\t\t\t\t\tdin_valid <= 1;\n\t\t\t\t\tdin_data <= 8'h 03;\n\t\t\t\t\tif (din_ready)\n\t\t\t\t\t\tstate <= 5;\n\t\t\t\tend\n\t\t\t\t5: begin\n\t\t\t\t\tif (valid && !ready) begin\n\t\t\t\t\t\tdin_valid <= 1;\n\t\t\t\t\t\tdin_data <= addr[23:16];\n\t\t\t\t\t\tif (din_ready)\n\t\t\t\t\t\t\tstate <= 6;\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\t\t6: begin\n\t\t\t\t\tdin_valid <= 1;\n\t\t\t\t\tdin_data <= addr[15:8];\n\t\t\t\t\tif (din_ready)\n\t\t\t\t\t\tstate <= 7;\n\t\t\t\tend\n\t\t\t\t7: begin\n\t\t\t\t\tdin_valid <= 1;\n\t\t\t\t\tdin_data <= addr[7:0];\n\t\t\t\t\tif (din_ready)\n\t\t\t\t\t\tstate <= 8;\n\t\t\t\tend\n\t\t\t\t8: begin\n\t\t\t\t\tdin_valid <= 1;\n\t\t\t\t\tdin_data <= 8'h 00;\n\t\t\t\t\tif (din_ready) begin\n\t\t\t\t\t\tbuffer_wen <= 4'b 0001;\n\t\t\t\t\t\tstate <= 9;\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\t\t9: begin\n\t\t\t\t\tdin_valid <= 1;\n\t\t\t\t\tdin_data <= 8'h 00;\n\t\t\t\t\tif (din_ready) begin\n\t\t\t\t\t\tbuffer_wen <= 4'b 0010;\n\t\t\t\t\t\tstate <= 10;\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\t\t10: begin\n\t\t\t\t\tdin_valid <= 1;\n\t\t\t\t\tdin_data <= 8'h 00;\n\t\t\t\t\tif (din_ready) begin\n\t\t\t\t\t\tbuffer_wen <= 4'b 0100;\n\t\t\t\t\t\tstate <= 11;\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\t\t11: begin\n\t\t\t\t\tif (!rd_wait || valid) begin\n\t\t\t\t\t\tdin_valid <= 1;\n\t\t\t\t\t\tdin_data <= 8'h 00;\n\t\t\t\t\t\tif (din_ready) begin\n\t\t\t\t\t\t\tbuffer_wen <= 4'b 1000;\n\t\t\t\t\t\t\tstate <= 8;\n\t\t\t\t\t\tend\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\tendcase\n\n\t\t\tif (jump) begin\n\t\t\t\trd_inc <= 0;\n\t\t\t\trd_valid <= 0;\n\t\t\t\txfer_resetn <= 0;\n\t\t\t\tstate <= 4;\n\t\t\tend\n\t\tend\n\tend\nendmodule\n\nmodule spimemio_xfer (\n\tinput clk, resetn,\n\n"], "Clone Blocks": [], "Diff Content": {"Delete": [], "Add": [[107, "\t\t\tbuffer_wen <= 0;\n"], [222, "\t\t\t\tbuffer_wen <= 0;\n"]]}}