{"Source Block": ["amiga2000-gfxcard/z2-minispartan/z2.v@2200:2347@HdlStmProcess", "reg [1:0] counter_scanout_words = 1;\nreg [1:0] max_repeat = 0;\nreg counter_vscale = 0;\nreg aligned_row_mode = 1;\n\nalways @(posedge vga_clk) begin\n  x_safe_area <= ((counter_scanout > safe_x2) || (counter_scanout < safe_x1));\n  \n  if (counter_x > vga_h_max) begin\n    counter_x <= 0;\n    if (counter_y > vga_v_max) begin\n      counter_y <= 0;\n    end else begin\n      counter_y <= counter_y + 1'b1;\n    end\n  end else begin\n    counter_x <= counter_x + 1'b1;\n  end\n  \n  if (counter_x>=vga_h_sync_start && counter_x<vga_h_sync_end)\n    dvi_hsync <= 1;\n  else\n    dvi_hsync <= 0;\n    \n  if (counter_y>=vga_v_sync_start && counter_y<vga_v_sync_end)\n    dvi_vsync <= 1;\n  else\n    dvi_vsync <= 0;\n      \n  if (counter_x<vga_h_rez && counter_y<vga_v_rez) begin\n    dvi_blank <= 0;\n  end else begin\n    dvi_blank <= 1;\n  end\n  \n  if (vga_colormode==0)\n    if (vga_scalemode_h==1)\n      max_repeat <= 3;\n    else\n      max_repeat <= 1;\n  else\n    if (vga_scalemode_h==1)\n      max_repeat <= 1;\n    else\n      max_repeat <= 0;\n  \n  if (vga_colormode==2)\n    counter_scanout_words <= 2;\n  else\n    counter_scanout_words <= 1;\n\n  if ((counter_y < vga_screen_h) || ((counter_x > vga_h_max) && counter_y>vga_v_max)) begin\n    if ((counter_x < vga_h_rez-1) || ((counter_x > vga_h_max) && counter_y!=vga_screen_h-1)) begin\n      display_pixels <= 1;\n    \n      if (counter_repeat == max_repeat) begin\n        counter_repeat <= 0;\n        counter_px <= (counter_px + counter_scanout_words);\n        \n        if (counter_vscale==0) begin\n          counter_scanout <= (counter_scanout + counter_scanout_words);\n          if (counter_scanout == fetch_preroll)\n            need_row_fetch_y <= need_row_fetch_y+1'b1;\n        end\n      end else\n        counter_repeat <= counter_repeat+1'b1;\n      \n    end else begin\n      counter_px <= 0;\n      if (aligned_row_mode)\n        counter_scanout <= 0;\n      display_pixels <= 0;\n    end\n    \n    if ((counter_x == vga_h_rez) && (vga_scalemode_v==1)) begin\n      counter_vscale <= ~counter_vscale;\n    end\n  end else begin\n    need_row_fetch_y <= 0;\n    display_pixels <= 0;\n    \n    counter_scanout <= 0;\n    counter_vscale <= 0;\n    counter_px <= 0;\n    counter_repeat <= 0;\n  end\n\n  counter_repeat_delayed <= counter_repeat;\n  \n  if (vga_scalemode_v == 0 || counter_vscale == 0) begin\n    rgb  <= fetch_buffer[counter_scanout];\n    rgb2 <= fetch_buffer[counter_scanout+1'b1];\n    \n    scale_buffer[counter_x] <= rgb;\n  end else begin\n    //if (counter_x<vga_h_rez) begin\n      rgb <= scale_buffer[counter_x+1'b1];\n      //rgb2 <= scale_buffer[counter_px+1'b1];\n      rgb2 <= 0;\n    //end else begin\n    //  rgb <= 0;\n    //  rgb2 <= 0;\n    //end\n  end\n  \n  if (!display_pixels) begin\n    red_p   <= 0;\n    green_p <= 0;\n    blue_p  <= 0;\n  end else if (vga_colormode==0) begin\n    // 8 bit palette indexed\n    // 0: +0a +0b +1a\n    // 1: +0b +1a +1b\n    \n    /*if (preheat) begin\n      red_p <= 0;\n      green_p <= 0;\n      blue_p <= 0;\n      preheat <= 0;\n    end else*/ \n    if (counter_repeat_delayed[vga_scalemode_h]==1) begin\n      red_p   <= palette_r[rgb[7:0]];\n      green_p <= palette_g[rgb[7:0]];\n      blue_p  <= palette_b[rgb[7:0]];\n    end else begin\n      red_p   <= palette_r[rgb[15:8]];\n      green_p <= palette_g[rgb[15:8]];\n      blue_p  <= palette_b[rgb[15:8]];\n    end\n  end else if (vga_colormode==1) begin\n    // decode 16 to 24 bit color\n    red_p   <= {rgb[4:0],  rgb[4:2]};\n    green_p <= {rgb[10:5], rgb[10:9]};\n    blue_p  <= {rgb[15:11],rgb[15:13]};\n    \n  end else if (vga_colormode==2) begin\n    // true color\n    blue_p   <= rgb2[15:8];\n    green_p <= rgb[7:0];\n    red_p  <= rgb[15:8];\n  end else begin\n    red_p   <= 0;\n    green_p <= 0;\n    blue_p  <= 0;\n  end\nend\n\nendmodule\n"], "Clone Blocks": [], "Diff Content": {"Delete": [[2293, "    scale_buffer[counter_x] <= rgb;\n"], [2296, "      rgb <= scale_buffer[counter_x+1'b1];\n"], [2298, "      rgb2 <= 0;\n"]], "Add": [[2293, "    if (counter_x<=vga_h_rez)\n"], [2293, "      scale_buffer[counter_x] <= {rgb2[15:8],rgb};\n"], [2293, "    if (counter_x==0)\n"], [2293, "      sb0 <= rgb;\n"], [2298, "    if (counter_x<vga_h_rez) begin\n"], [2298, "      rgb  <= scale_buffer[counter_px][15:0];\n"], [2298, "      rgb2 <= {scale_buffer[counter_px][23:16],8'b00000000};\n"], [2298, "    end else\n"], [2298, "      rgb <= sb0;\n"]]}}